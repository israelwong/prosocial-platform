generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model platform_billing_cycles {
  id                String        @id @default(cuid())
  subscription_id   String
  period_start      DateTime
  period_end        DateTime
  amount            Decimal
  status            String
  stripe_invoice_id String?
  created_at        DateTime      @default(now())
  subscriptions     subscriptions @relation(fields: [subscription_id], references: [id], onDelete: Cascade)

  @@index([period_start, period_end])
  @@index([status])
  @@index([subscription_id])
}

model platform_config {
  id                    String   @id @default(cuid())
  nombre_empresa        String
  logo_url              String?
  favicon_url           String?
  comercial_telefono    String?
  comercial_email       String?
  comercial_whatsapp    String?
  soporte_telefono      String?
  soporte_email         String?
  soporte_chat_url      String?
  direccion             String?
  horarios_atencion     String?
  timezone              String   @default("America/Mexico_City")
  facebook_url          String?
  instagram_url         String?
  twitter_url           String?
  linkedin_url          String?
  terminos_condiciones  String?
  politica_privacidad   String?
  aviso_legal           String?
  meta_description      String?
  meta_keywords         String?
  google_analytics_id   String?
  google_tag_manager_id String?
  createdAt             DateTime @default(now())
  updatedAt             DateTime
}

model platform_services {
  id            String             @id @default(cuid())
  name          String             @unique
  slug          String             @unique
  description   String?
  active        Boolean            @default(true)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  posicion      Int                @default(0)
  categoryId    String
  plan_services plan_services[]
  category      service_categories @relation(fields: [categoryId], references: [id])

  @@index([active, posicion])
  @@index([categoryId])
}

model platform_acquisition_channels {
  id             String           @id @default(cuid())
  name           String           @unique
  description    String?
  color          String?
  icon           String?
  isActive       Boolean          @default(true)
  isVisible      Boolean          @default(true)
  order          Int              @default(0)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  platform_leads platform_leads[]

  @@index([isActive])
  @@index([isVisible])
}

model platform_lead_bitacora {
  id             String                   @id @default(cuid())
  leadId         String
  tipo           PlatformLeadBitacoraTipo
  titulo         String?
  descripcion    String
  metadata       Json?
  usuarioId      String?
  createdAt      DateTime                 @default(now())
  updatedAt      DateTime
  platform_leads platform_leads           @relation(fields: [leadId], references: [id], onDelete: Cascade)
  user_profiles  project_user_profiles?   @relation(fields: [usuarioId], references: [id])

  @@index([createdAt])
  @@index([leadId])
  @@index([tipo])
}

model platform_leads {
  id                            String                          @id @default(cuid())
  name                          String
  email                         String                          @unique
  phone                         String
  studioName                    String?
  studioSlug                    String?
  lastContactDate               DateTime?
  interestedPlan                String?
  avatarUrl                     String?
  probableStartDate             DateTime?
  agentId                       String?
  score                         Int?
  priority                      String                          @default("medium")
  conversionDate                DateTime?
  studioId                      String?                         @unique
  createdAt                     DateTime                        @default(now())
  updatedAt                     DateTime
  stageId                       String?
  acquisitionChannelId          String?
  campaignId                    String?                         @map("campañaId")
  agentConversionId             String?
  firstInteractionDate          DateTime?
  originalSource                String?
  conversionMethod              String?
  interactionCount              Int?                            @default(0)
  leadType                      String?                         @default("prospect")
  utm_campaign                  String?
  utm_medium                    String?
  utm_source                    String?
  platform_activities           platform_activities[]
  agent_discount_codes          platform_agent_discount_codes[]
  discount_usage                platform_discount_usage[]
  platform_lead_bitacora        platform_lead_bitacora[]
  platform_acquisition_channels platform_acquisition_channels?  @relation(fields: [acquisitionChannelId], references: [id])
  platform_agents               platform_agents?                @relation(fields: [agentId], references: [id])
  platform_campaigns            platform_campaigns?             @relation(fields: [campaignId], references: [id])
  platform_pipeline_stages      platform_pipeline_stages?       @relation(fields: [stageId], references: [id])
  studios                       projects?                       @relation(fields: [studioId], references: [id])
  platform_notifications        platform_notifications[]

  @@index([agentId])
  @@index([campaignId])
  @@index([acquisitionChannelId])
  @@index([stageId, priority])
}

model platform_notifications {
  id              String                @id @default(cuid())
  userId          String
  titulo          String
  mensaje         String
  tipo            String                @default("info")
  categoria       String                @default("general")
  metadata        Json?
  isRead          Boolean               @default(false)
  isActive        Boolean               @default(true)
  priority        String                @default("medium")
  leadId          String?
  agentId         String?
  scheduledFor    DateTime?
  expiresAt       DateTime?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime
  platform_agents platform_agents?      @relation(fields: [agentId], references: [id])
  platform_leads  platform_leads?       @relation(fields: [leadId], references: [id])
  user_profiles   project_user_profiles @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([scheduledFor])
  @@index([tipo, categoria])
  @@index([userId, isActive])
  @@index([userId, isRead])
}

model platform_pipeline_types {
  id              String                     @id @default(cuid())
  nombre          String                     @unique
  descripcion     String?
  color           String                     @default("#3B82F6")
  activo          Boolean                    @default(true)
  orden           Int                        @default(0)
  createdAt       DateTime                   @default(now())
  updatedAt       DateTime
  pipeline_stages platform_pipeline_stages[]

  @@index([activo])
  @@index([orden])
}

model platform_pipeline_stages {
  id               String                   @id @default(cuid())
  nombre           String
  descripcion      String?
  color            String                   @default("#3B82F6")
  orden            Int                      @default(0)
  isActive         Boolean                  @default(true)
  createdAt        DateTime                 @default(now())
  updatedAt        DateTime
  pipeline_type_id String?
  platform_leads   platform_leads[]
  pipeline_type    platform_pipeline_types? @relation(fields: [pipeline_type_id], references: [id])

  @@index([isActive])
  @@index([orden])
  @@index([pipeline_type_id])
}

model platform_advertising_platforms {
  id                          String                        @id @default(cuid())
  name                        String                        @unique
  description                 String?
  type                        String
  color                       String?
  icon                        String?
  isActive                    Boolean                       @default(true)
  order                       Int                           @default(0)
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  platform_campaign_platforms platform_campaign_platforms[]

  @@index([isActive])
  @@index([type])
}

model platform_plans {
  id                String          @id @default(cuid())
  name              String
  slug              String          @unique
  features          Json?
  popular           Boolean         @default(false)
  active            Boolean         @default(true)
  orden             Int             @default(0)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  description       String?
  limits            Json?
  price_monthly     Decimal?
  price_yearly      Decimal?
  stripe_price_id   String?         @unique
  stripe_product_id String?
  plan_services     plan_services[]
  projects          projects[]
  subscriptions     subscriptions[]

  @@index([active, orden])
  @@index([stripe_price_id])
}

model platform_activities {
  id                 String                 @id @default(cuid())
  leadId             String
  tipo               String
  descripcion        String
  resultado          String?
  proximaAccion      String?
  fechaProximaAccion DateTime?
  createdAt          DateTime               @default(now())
  userId             String?
  platform_leads     platform_leads         @relation(fields: [leadId], references: [id])
  user_profiles      project_user_profiles? @relation(fields: [userId], references: [id])

  @@index([leadId, createdAt])
  @@index([userId, createdAt])
}

model platform_agents {
  id                     String                          @id @default(cuid())
  nombre                 String
  email                  String                          @unique
  telefono               String
  activo                 Boolean                         @default(true)
  metaMensualLeads       Int                             @default(20)
  comisionConversion     Decimal                         @default(0.05)
  createdAt              DateTime                        @default(now())
  updatedAt              DateTime
  agent_discount_codes   platform_agent_discount_codes[]
  platform_leads         platform_leads[]
  platform_notifications platform_notifications[]

  @@index([activo])
}

model platform_campaign_platforms {
  id                             String                         @id @default(cuid())
  campaignId                     String                         @map("campañaId")
  platformId                     String
  budget                         Decimal
  actualSpend                    Decimal                        @default(0)
  leads                          Int                            @default(0)
  conversions                    Int                            @default(0)
  createdAt                      DateTime                       @default(now())
  updatedAt                      DateTime
  platform_campaigns             platform_campaigns             @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  platform_advertising_platforms platform_advertising_platforms @relation(fields: [platformId], references: [id])

  @@unique([campaignId, platformId])
  @@index([campaignId])
  @@index([platformId])
}

model platform_campaigns {
  id                          String                        @id @default(cuid())
  name                        String
  description                 String?
  totalBudget                 Decimal
  startDate                   DateTime
  endDate                     DateTime
  isActive                    Boolean                       @default(true)
  status                      String                        @default("planned")
  leadsGenerated              Int                           @default(0)
  leadsSubscribed             Int                           @default(0)
  actualSpend                 Decimal                       @default(0)
  projectId                   String?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  platform_campaign_platforms platform_campaign_platforms[]
  projects                    projects?                     @relation(fields: [projectId], references: [id])
  platform_leads              platform_leads[]

  @@index([startDate, endDate])
  @@index([isActive])
  @@index([status])
  @@index([projectId])
}

model platform_discount_codes {
  id               String                    @id @default(cuid())
  codigo           String                    @unique
  nombre           String
  descripcion      String?
  tipo_descuento   String
  valor_descuento  Decimal
  tipo_aplicacion  String
  fecha_inicio     DateTime
  fecha_fin        DateTime
  uso_maximo       Int?
  uso_actual       Int                       @default(0)
  activo           Boolean                   @default(true)
  stripe_coupon_id String?                   @unique
  createdAt        DateTime                  @default(now())
  updatedAt        DateTime
  discount_usage   platform_discount_usage[]

  @@index([activo])
  @@index([fecha_inicio, fecha_fin])
  @@index([stripe_coupon_id])
}

model platform_discount_usage {
  id               String                  @id @default(cuid())
  discount_code_id String
  lead_id          String?
  subscription_id  String?
  monto_descuento  Decimal
  fecha_uso        DateTime                @default(now())
  discount_code    platform_discount_codes @relation(fields: [discount_code_id], references: [id])
  lead             platform_leads?         @relation(fields: [lead_id], references: [id])
  subscription     subscriptions?          @relation(fields: [subscription_id], references: [id])

  @@index([discount_code_id])
  @@index([lead_id])
  @@index([subscription_id])
  @@index([fecha_uso])
}

model platform_agent_discount_codes {
  id                 String          @id @default(cuid())
  codigo_base        String
  lead_id            String
  agente_id          String
  codigo_completo    String          @unique
  tipo_descuento     String
  valor_descuento    Decimal
  duracion_descuento String
  stripe_coupon_id   String?         @unique
  fecha_creacion     DateTime        @default(now())
  fecha_expiracion   DateTime
  usado              Boolean         @default(false)
  fecha_uso          DateTime?
  subscription_id    String?
  activo             Boolean         @default(true)
  agente             platform_agents @relation(fields: [agente_id], references: [id])
  lead               platform_leads  @relation(fields: [lead_id], references: [id])
  subscription       subscriptions?  @relation(fields: [subscription_id], references: [id])

  @@index([lead_id])
  @@index([agente_id])
  @@index([codigo_completo])
  @@index([usado])
  @@index([fecha_expiracion])
}

model projects {
  id                       String                            @id @default(cuid())
  name                     String
  slug                     String                            @unique
  email                    String                            @unique
  phone                    String?
  address                  String?
  website                  String?
  logoUrl                  String?
  planId                   String?
  subscriptionStatus       SubscriptionStatus                @default(TRIAL)
  subscriptionStart        DateTime?
  subscriptionEnd          DateTime?
  stripeCustomerId         String?                           @unique
  stripeSubscriptionId     String?                           @unique
  stripeAccountId          String?                           @unique
  stripeOnboardingComplete Boolean                           @default(false)
  commissionRate           Decimal                           @default(0.30)
  active                   Boolean                           @default(true)
  createdAt                DateTime                          @default(now())
  updatedAt                DateTime
  descripcion              String?
  isotipo_url              String?
  palabras_clave           String?
  slogan                   String?
  platform_campaigns       platform_campaigns[]
  platform_leads           platform_leads?
  platform_user_profiles   platform_user_profiles[]
  agenda                   project_agenda[]
  categorias_personal      project_categorias_personal[]
  clientes                 project_clientes[]
  condiciones_comerciales  project_condiciones_comerciales[]
  configuraciones          project_configuraciones[]
  cotizaciones             project_cotizaciones[]
  cuentas_bancarias        project_cuentas_bancarias[]
  eventos                  project_eventos[]
  gastos                   project_gastos[]
  horarios_atencion        project_horarios_atencion[]
  metodos_pago             project_metodos_pago[]
  nominas                  project_nominas[]
  paquetes                 project_paquetes[]
  personal                 project_personal[]
  personal_profiles        project_personal_profiles[]
  redes_sociales           project_redes_sociales[]
  reglas_agendamiento      project_reglas_agendamiento[]
  revenue_transactions     project_revenue_transactions[]
  servicios                project_servicios[]
  studio_revenue_products  project_studio_revenue_products[]
  telefonos                project_telefonos[]
  user_profiles            project_user_profiles[]
  studio_users             project_users[]
  plans                    platform_plans?                   @relation(fields: [planId], references: [id])
  setup_status             studio_setup_status?
  subscriptions            subscriptions[]

  @@index([planId])
  @@index([slug])
}

model project_configuraciones {
  id                String   @id @default(cuid())
  projectId         String
  nombre            String
  utilidad_servicio Float
  utilidad_producto Float
  comision_venta    Float
  sobreprecio       Float
  claveAutorizacion String?
  status            String   @default("active")
  createdAt         DateTime @default(now())
  updatedAt         DateTime
  projects          projects @relation(fields: [projectId], references: [id])

  @@index([projectId])
}

model project_agenda {
  id            String          @id @default(cuid())
  projectId     String
  userId        String?
  eventoId      String
  concepto      String?
  descripcion   String?
  googleMapsUrl String?
  direccion     String?
  fecha         DateTime?
  hora          String?
  status        String          @default("pendiente")
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  agendaTipo    String?
  eventos       project_eventos @relation(fields: [eventoId], references: [id])
  projects      projects        @relation(fields: [projectId], references: [id])
  project_users project_users?  @relation(fields: [userId], references: [id])

  @@index([projectId])
}

model project_agenda_tipos {
  id        String   @id @default(cuid())
  nombre    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model project_clientes {
  id                     String                  @id @default(cuid())
  projectId              String
  platformUserId         String?
  nombre                 String
  email                  String
  telefono               String
  direccion              String?
  status                 String                  @default("activo")
  isActive               Boolean                 @default(true)
  lastLogin              DateTime?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime
  platform_user_profiles platform_user_profiles? @relation(fields: [platformUserId], references: [id])
  projects               projects                @relation(fields: [projectId], references: [id])
  eventos                project_eventos[]
  pagos                  project_pagos[]

  @@index([projectId, email])
  @@index([projectId, status])
  @@index([projectId, telefono])
  @@index([platformUserId])
}

model project_condiciones_comerciales {
  id                                  String                                        @id @default(cuid())
  projectId                           String
  nombre                              String
  descripcion                         String?
  porcentaje_descuento                Float?
  porcentaje_anticipo                 Float?                                        @default(0)
  status                              String                                        @default("active")
  orden                               Int?                                          @default(0)
  createdAt                           DateTime                                      @default(now())
  updatedAt                           DateTime
  projects                            projects                                      @relation(fields: [projectId], references: [id])
  condiciones_comerciales_metodo_pago project_condiciones_comerciales_metodo_pago[]
  cotizaciones                        project_cotizaciones[]
  pagos                               project_pagos[]

  @@index([projectId])
}

model project_condiciones_comerciales_metodo_pago {
  id                       String                          @id @default(cuid())
  condicionesComercialesId String
  metodoPagoId             String
  orden                    Int?                            @default(0)
  status                   String                          @default("active")
  createdAt                DateTime                        @default(now())
  updatedAt                DateTime
  condiciones_comerciales  project_condiciones_comerciales @relation(fields: [condicionesComercialesId], references: [id], onDelete: Cascade)
  metodos_pago             project_metodos_pago            @relation(fields: [metodoPagoId], references: [id])
  pagos                    project_pagos[]
  cotizaciones             project_cotizaciones[]          @relation("CondicionesComercialesMetodoPagoToCotizacion")
}

model project_cotizacion_costos {
  id           String               @id @default(cuid())
  cotizacionId String
  nombre       String
  descripcion  String?
  costo        Float                @default(0)
  tipo         String               @default("adicional")
  posicion     Int                  @default(0)
  createdAt    DateTime             @default(now())
  updatedAt    DateTime
  cotizaciones project_cotizaciones @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)
}

model project_cotizacion_servicios {
  id                        String                       @id @default(cuid())
  cotizacionId              String
  servicioId                String?
  servicioCategoriaId       String?
  cantidad                  Int                          @default(1)
  posicion                  Int                          @default(0)
  userId                    String?
  fechaAsignacion           DateTime?
  FechaEntrega              DateTime?
  status                    String                       @default("pendiente")
  seccion_nombre_snapshot   String?
  categoria_nombre_snapshot String?
  nombre_snapshot           String                       @default("Servicio migrado")
  descripcion_snapshot      String?
  precio_unitario_snapshot  Float                        @default(0)
  costo_snapshot            Float                        @default(0)
  gasto_snapshot            Float                        @default(0)
  utilidad_snapshot         Float                        @default(0)
  precio_publico_snapshot   Float                        @default(0)
  tipo_utilidad_snapshot    String                       @default("servicio")
  precioUnitario            Float                        @default(0)
  subtotal                  Float                        @default(0)
  nombre                    String?
  descripcion               String?
  costo                     Float?                       @default(0)
  gasto                     Float?                       @default(0)
  utilidad                  Float?                       @default(0)
  precio_publico            Float?                       @default(0)
  tipo_utilidad             String?                      @default("servicio")
  categoria_nombre          String?
  seccion_nombre            String?
  es_personalizado          Boolean                      @default(false)
  servicio_original_id      String?
  createdAt                 DateTime                     @default(now())
  updatedAt                 DateTime
  cotizaciones              project_cotizaciones         @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)
  servicio_categorias       project_servicio_categorias? @relation(fields: [servicioCategoriaId], references: [id])
  servicios                 project_servicios?           @relation(fields: [servicioId], references: [id])
  studio_users              project_users?               @relation(fields: [userId], references: [id])
  nomina_servicios          project_nomina_servicios[]
}

model project_cotizacion_visitas {
  id           String               @id @default(cuid())
  cotizacionId String
  createdAt    DateTime             @default(now())
  cotizaciones project_cotizaciones @relation(fields: [cotizacionId], references: [id], onDelete: Cascade)
}

model project_cotizaciones {
  id                                  String                                        @id @default(cuid())
  projectId                           String
  eventoTipoId                        String
  eventoId                            String
  nombre                              String
  precio                              Float
  descuento                           Float?
  descripcion                         String?
  condicionesComercialesId            String?
  condicionesComercialesMetodoPagoId  String?
  status                              String                                        @default("pendiente")
  archivada                           Boolean                                       @default(false)
  visible_cliente                     Boolean?                                      @default(true)
  createdAt                           DateTime                                      @default(now())
  updatedAt                           DateTime
  expiresAt                           DateTime?                                     @default(dbgenerated("(now() + '10 days'::interval)"))
  cotizacion_costos                   project_cotizacion_costos[]
  cotizacion_servicios                project_cotizacion_servicios[]
  cotizacion_visitas                  project_cotizacion_visitas[]
  condiciones_comerciales             project_condiciones_comerciales?              @relation(fields: [condicionesComercialesId], references: [id])
  eventos                             project_eventos                               @relation(fields: [eventoId], references: [id])
  evento_tipos                        project_evento_tipos                          @relation(fields: [eventoTipoId], references: [id])
  projects                            projects                                      @relation(fields: [projectId], references: [id])
  pagos                               project_pagos[]
  condiciones_comerciales_metodo_pago project_condiciones_comerciales_metodo_pago[] @relation("CondicionesComercialesMetodoPagoToCotizacion")

  @@index([eventoId])
  @@index([projectId, status])
}

model project_evento_bitacoras {
  id          String          @id @default(cuid())
  eventoId    String
  comentario  String
  importancia String          @default("1")
  status      String          @default("active")
  createdAt   DateTime        @default(now())
  updatedAt   DateTime
  eventos     project_eventos @relation(fields: [eventoId], references: [id])
}

model project_evento_etapas {
  id        String            @id @default(cuid())
  nombre    String
  posicion  Int               @default(0)
  createdAt DateTime          @default(now())
  updatedAt DateTime
  eventos   project_eventos[]
}

model project_evento_tipos {
  id           String                 @id @default(cuid())
  nombre       String
  posicion     Int                    @default(0)
  createdAt    DateTime               @default(now())
  updatedAt    DateTime
  cotizaciones project_cotizaciones[]
  eventos      project_eventos[]
  paquetes     project_paquetes[]
}

model project_eventos {
  id               String                     @id @default(cuid())
  projectId        String
  clienteId        String
  eventoTipoId     String?
  nombre           String?                    @default("Pendiente")
  fecha_evento     DateTime
  sede             String?
  direccion        String?
  status           String                     @default("active")
  createdAt        DateTime                   @default(now())
  updatedAt        DateTime
  userId           String?
  eventoEtapaId    String?
  agenda           project_agenda[]
  cotizaciones     project_cotizaciones[]
  evento_bitacoras project_evento_bitacoras[]
  clientes         project_clientes           @relation(fields: [clienteId], references: [id])
  evento_etapas    project_evento_etapas?     @relation(fields: [eventoEtapaId], references: [id])
  evento_tipos     project_evento_tipos?      @relation(fields: [eventoTipoId], references: [id])
  projects         projects                   @relation(fields: [projectId], references: [id])
  project_users    project_users?             @relation(fields: [userId], references: [id])
  gastos           project_gastos[]
  nominas          project_nominas[]

  @@index([clienteId])
  @@index([fecha_evento])
  @@index([projectId, status])
}

model project_gastos {
  id             String           @id @default(cuid())
  projectId      String
  concepto       String
  descripcion    String?
  monto          Float
  categoria      String
  subcategoria   String?
  fecha          DateTime         @default(now())
  fechaFactura   DateTime?
  status         String           @default("activo")
  metodoPago     String?
  numeroFactura  String?
  proveedor      String?
  eventoId       String?
  usuarioId      String
  comprobanteUrl String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  eventos        project_eventos? @relation(fields: [eventoId], references: [id])
  projects       projects         @relation(fields: [projectId], references: [id])
  project_users  project_users    @relation(fields: [usuarioId], references: [id])

  @@index([eventoId])
  @@index([fecha, categoria])
  @@index([projectId])
}

model project_metodos_pago {
  id                                  String                                        @id @default(cuid())
  projectId                           String
  metodo_pago                         String
  comision_porcentaje_base            Float?
  comision_fija_monto                 Float?
  num_msi                             Int?
  comision_msi_porcentaje             Float?
  orden                               Int?                                          @default(0)
  payment_method                      String?                                       @default("card")
  status                              String                                        @default("active")
  createdAt                           DateTime                                      @default(now())
  updatedAt                           DateTime
  condiciones_comerciales_metodo_pago project_condiciones_comerciales_metodo_pago[]
  projects                            projects                                      @relation(fields: [projectId], references: [id])
  pagos                               project_pagos[]

  @@index([projectId])
}

model project_nomina_servicios {
  id                   String                        @id @default(cuid())
  nominaId             String
  cotizacionServicioId String?
  servicio_nombre      String
  seccion_nombre       String?
  categoria_nombre     String?
  costo_asignado       Float
  cantidad_asignada    Int                           @default(1)
  createdAt            DateTime                      @default(now())
  cotizacion_servicios project_cotizacion_servicios? @relation(fields: [cotizacionServicioId], references: [id])
  nominas              project_nominas               @relation(fields: [nominaId], references: [id], onDelete: Cascade)

  @@unique([nominaId, cotizacionServicioId])
}

model project_nominas {
  id                                                  String                     @id @default(cuid())
  projectId                                           String
  userId                                              String
  eventoId                                            String?
  concepto                                            String
  descripcion                                         String?
  monto_bruto                                         Float
  deducciones                                         Float                      @default(0)
  monto_neto                                          Float
  tipo_pago                                           String                     @default("individual")
  servicios_incluidos                                 Int                        @default(1)
  fecha_asignacion                                    DateTime                   @default(now())
  fecha_autorizacion                                  DateTime?
  fecha_pago                                          DateTime?
  periodo_inicio                                      DateTime?
  periodo_fin                                         DateTime?
  status                                              String                     @default("pendiente")
  autorizado_por                                      String?
  pagado_por                                          String?
  metodo_pago                                         String?                    @default("transferencia")
  costo_total_snapshot                                Float                      @default(0)
  gasto_total_snapshot                                Float                      @default(0)
  comision_porcentaje                                 Float?
  createdAt                                           DateTime                   @default(now())
  updatedAt                                           DateTime
  personalId                                          String?
  nomina_servicios                                    project_nomina_servicios[]
  project_users_nominas_autorizado_porToproject_users project_users?             @relation("nominas_autorizado_porToproject_users", fields: [autorizado_por], references: [id])
  eventos                                             project_eventos?           @relation(fields: [eventoId], references: [id])
  project_users_nominas_pagado_porToproject_users     project_users?             @relation("nominas_pagado_porToproject_users", fields: [pagado_por], references: [id])
  personal                                            project_personal?          @relation(fields: [personalId], references: [id])
  projects                                            projects                   @relation(fields: [projectId], references: [id])
  project_users_nominas_userIdToproject_users         project_users              @relation("nominas_userIdToproject_users", fields: [userId], references: [id])

  @@index([projectId])
}

model project_pagos {
  id                                  String                                       @id @default(cuid())
  clienteId                           String?
  cotizacionId                        String?
  condicionesComercialesId            String?
  condicionesComercialesMetodoPagoId  String?
  metodoPagoId                        String?
  metodo_pago                         String
  monto                               Float
  comisionStripe                      Float?
  concepto                            String
  descripcion                         String?
  stripe_session_id                   String?                                      @unique
  stripe_payment_id                   String?                                      @unique
  status                              String                                       @default("pending")
  createdAt                           DateTime                                     @default(now())
  updatedAt                           DateTime
  userId                              String?
  tipo_transaccion                    String?                                      @default("ingreso")
  categoria_transaccion               String?                                      @default("abono")
  clientes                            project_clientes?                            @relation(fields: [clienteId], references: [id])
  condiciones_comerciales             project_condiciones_comerciales?             @relation(fields: [condicionesComercialesId], references: [id])
  condiciones_comerciales_metodo_pago project_condiciones_comerciales_metodo_pago? @relation(fields: [condicionesComercialesMetodoPagoId], references: [id])
  cotizaciones                        project_cotizaciones?                        @relation(fields: [cotizacionId], references: [id])
  metodos_pago                        project_metodos_pago?                        @relation(fields: [metodoPagoId], references: [id])
  studio_users                        project_users?                               @relation(fields: [userId], references: [id])
}

model project_paquete_servicios {
  id                  String                      @id @default(cuid())
  paqueteId           String
  servicioId          String
  servicioCategoriaId String
  cantidad            Int                         @default(1)
  posicion            Int                         @default(0)
  visible_cliente     Boolean                     @default(true)
  status              String                      @default("active")
  createdAt           DateTime                    @default(now())
  updatedAt           DateTime
  paquetes            project_paquetes            @relation(fields: [paqueteId], references: [id], onDelete: Cascade)
  servicio_categorias project_servicio_categorias @relation(fields: [servicioCategoriaId], references: [id])
  servicios           project_servicios           @relation(fields: [servicioId], references: [id])
}

model project_paquetes {
  id                String                      @id @default(cuid())
  projectId         String
  eventoTipoId      String
  nombre            String
  costo             Float?
  gasto             Float?
  utilidad          Float?
  precio            Float?
  status            String                      @default("active")
  posicion          Int                         @default(0)
  createdAt         DateTime                    @default(now())
  updatedAt         DateTime
  paquete_servicios project_paquete_servicios[]
  evento_tipos      project_evento_tipos        @relation(fields: [eventoTipoId], references: [id])
  projects          projects                    @relation(fields: [projectId], references: [id])

  @@index([projectId, status])
}

model project_revenue_products {
  id                      String                            @id @default(cuid())
  nombre                  String
  descripcion             String
  categoria               String
  precioPublico           Decimal
  comisionProsocial       Decimal
  comisionStudio          Decimal
  tipoFacturacion         String
  cicloVida               Int?
  activo                  Boolean                           @default(true)
  configuracion           Json?
  createdAt               DateTime                          @default(now())
  updatedAt               DateTime
  studio_revenue_products project_studio_revenue_products[]

  @@index([categoria, activo])
}

model project_revenue_transactions {
  id                  String   @id @default(cuid())
  projectId           String
  paymentId           String
  amountTotal         Decimal
  prosocialCommission Decimal
  studioAmount        Decimal
  commissionRate      Decimal
  description         String?
  transactionDate     DateTime @default(now())
  status              String   @default("pending")
  stripeTransferId    String?
  stripeFee           Decimal?
  createdAt           DateTime @default(now())
  updatedAt           DateTime
  projects            projects @relation(fields: [projectId], references: [id])

  @@index([status])
  @@index([projectId, transactionDate])
}

model project_seccion_categorias {
  id                  String                      @id @default(cuid())
  seccionId           String
  categoriaId         String                      @unique
  servicio_categorias project_servicio_categorias @relation(fields: [categoriaId], references: [id], onDelete: Cascade)
  servicio_secciones  project_servicio_secciones  @relation(fields: [seccionId], references: [id], onDelete: Cascade)
}

model project_servicio_categorias {
  id                   String                         @id @default(cuid())
  nombre               String                         @unique
  orden                Int                            @default(0)
  createdAt            DateTime                       @default(now())
  updatedAt            DateTime                       @updatedAt
  cotizacion_servicios project_cotizacion_servicios[]
  paquete_servicios    project_paquete_servicios[]
  seccion_categorias   project_seccion_categorias?
  servicios            project_servicios[]
}

model project_servicio_gastos {
  id         String            @id @default(cuid())
  servicioId String
  nombre     String
  costo      Float
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  servicios  project_servicios @relation(fields: [servicioId], references: [id], onDelete: Cascade)
}

model project_servicio_secciones {
  id                 String                       @id @default(cuid())
  nombre             String                       @unique
  descripcion        String?
  orden              Int                          @default(0)
  createdAt          DateTime                     @default(now())
  updatedAt          DateTime                     @updatedAt
  seccion_categorias project_seccion_categorias[]
}

model project_servicios {
  id                   String                         @id @default(cuid())
  studioId             String
  servicioCategoriaId  String
  nombre               String
  costo                Float                          @default(0)
  gasto                Float                          @default(0)
  utilidad             Float                          @default(0)
  precio_publico       Float                          @default(0)
  tipo_utilidad        String                         @default("servicio")
  orden                Int                            @default(0)
  status               String                         @default("active")
  createdAt            DateTime                       @default(now())
  updatedAt            DateTime                       @updatedAt
  cotizacion_servicios project_cotizacion_servicios[]
  paquete_servicios    project_paquete_servicios[]
  servicio_gastos      project_servicio_gastos[]
  projects             projects                       @relation(fields: [studioId], references: [id], map: "project_servicios_projectId_fkey")
  servicio_categorias  project_servicio_categorias    @relation(fields: [servicioCategoriaId], references: [id])

  @@index([studioId, status], map: "project_servicios_projectId_status_idx")
  @@index([studioId, status], map: "project_servicios_studioid_status_idx")
}

model project_studio_revenue_products {
  id                  String                   @id @default(cuid())
  projectId           String
  revenueProductId    String
  activo              Boolean                  @default(false)
  precioCustom        Decimal?
  comisionCustom      Decimal?
  configuracionStudio Json?
  activadoEn          DateTime?
  desactivadoEn       DateTime?
  createdAt           DateTime                 @default(now())
  updatedAt           DateTime
  projects            projects                 @relation(fields: [projectId], references: [id])
  revenue_products    project_revenue_products @relation(fields: [revenueProductId], references: [id])

  @@unique([projectId, revenueProductId])
  @@index([projectId, activo])
}

model project_users {
  id                                            String                         @id @default(cuid())
  projectId                                     String
  platformUserId                                String?
  fullName                                      String
  phone                                         String?
  type                                          PersonnelType
  role                                          String                         @default("user")
  status                                        String                         @default("inactive")
  isActive                                      Boolean                        @default(true)
  createdAt                                     DateTime                       @default(now())
  updatedAt                                     DateTime                       @updatedAt
  agenda                                        project_agenda[]
  cotizacion_servicios                          project_cotizacion_servicios[]
  eventos                                       project_eventos[]
  gastos                                        project_gastos[]
  nominas_nominas_autorizado_porToproject_users project_nominas[]              @relation("nominas_autorizado_porToproject_users")
  nominas_nominas_pagado_porToproject_users     project_nominas[]              @relation("nominas_pagado_porToproject_users")
  nominas_nominas_userIdToproject_users         project_nominas[]              @relation("nominas_userIdToproject_users")
  pagos                                         project_pagos[]
  platform_user_profiles                        platform_user_profiles?        @relation(fields: [platformUserId], references: [id])
  projects                                      projects                       @relation(fields: [projectId], references: [id])

  @@index([projectId, status])
  @@index([type])
  @@index([isActive])
  @@index([platformUserId])
}

model platform_user_profiles {
  id               String             @id @default(cuid())
  supabaseUserId   String?            @unique
  email            String             @unique
  role             UserRole
  fullName         String?
  avatarUrl        String?
  isActive         Boolean            @default(true)
  projectId        String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  projects         projects?          @relation(fields: [projectId], references: [id])
  project_clientes project_clientes[]
  project_personal project_personal[]
  project_users    project_users[]

  @@index([email])
  @@index([role])
  @@index([projectId])
  @@index([supabaseUserId])
}

model project_user_profiles {
  id                     String                   @id @default(cuid())
  email                  String                   @unique
  fullName               String?
  avatarUrl              String?
  role                   UserRole
  projectId              String?
  isActive               Boolean                  @default(true)
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  platform_activities    platform_activities[]
  platform_lead_bitacora platform_lead_bitacora[]
  platform_notifications platform_notifications[]
  projects               projects?                @relation(fields: [projectId], references: [id])

  @@index([email])
  @@index([role])
  @@index([projectId])
}

model subscriptions {
  id                     String                          @id @default(cuid())
  studio_id              String
  stripe_subscription_id String                          @unique
  stripe_customer_id     String
  plan_id                String
  status                 SubscriptionStatus
  current_period_start   DateTime
  current_period_end     DateTime
  billing_cycle_anchor   DateTime
  created_at             DateTime                        @default(now())
  updated_at             DateTime
  agent_discount_codes   platform_agent_discount_codes[]
  billing_cycles         platform_billing_cycles[]
  discount_usage         platform_discount_usage[]
  plans                  platform_plans                  @relation(fields: [plan_id], references: [id])
  projects               projects                        @relation(fields: [studio_id], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([stripe_subscription_id])
  @@index([studio_id])
}

model plan_services {
  id         String            @id @default(cuid())
  plan_id    String
  service_id String
  active     Boolean           @default(false)
  limite     Int?
  unidad     UnidadMedida?
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  plan       platform_plans    @relation(fields: [plan_id], references: [id], onDelete: Cascade)
  service    platform_services @relation(fields: [service_id], references: [id], onDelete: Cascade)

  @@unique([plan_id, service_id])
  @@index([plan_id])
  @@index([service_id])
}

model service_categories {
  id          String              @id @default(cuid())
  name        String              @unique
  description String
  icon        String
  posicion    Int                 @default(0)
  active      Boolean             @default(true)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  services    platform_services[]

  @@index([active, posicion])
}

model project_telefonos {
  id        String   @id @default(cuid())
  projectId String
  numero    String
  tipo      String
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  order     Int      @default(0)
  projects  projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([projectId, activo])
}

model project_horarios_atencion {
  id          String   @id @default(cuid())
  projectId   String
  dia_semana  String
  hora_inicio String
  hora_fin    String
  activo      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  projects    projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, dia_semana])
  @@index([projectId])
  @@index([projectId, dia_semana])
}

model platform_social_networks {
  id                     String                   @id @default(cuid())
  name                   String                   @unique
  slug                   String                   @unique
  description            String?
  color                  String?
  icon                   String?
  baseUrl                String?
  order                  Int                      @default(0)
  isActive               Boolean                  @default(true)
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  project_redes_sociales project_redes_sociales[]

  @@index([isActive])
  @@index([order])
}

model project_redes_sociales {
  id           String                    @id @default(cuid())
  projectId    String
  plataformaId String?
  url          String
  activo       Boolean                   @default(true)
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
  order        Int                       @default(0)
  plataforma   platform_social_networks? @relation(fields: [plataformaId], references: [id])
  projects     projects                  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, plataformaId])
  @@index([projectId])
  @@index([plataformaId])
}

model project_cuentas_bancarias {
  id           String   @id @default(cuid())
  projectId    String
  banco        String
  numeroCuenta String
  tipoCuenta   String
  titular      String
  activo       Boolean  @default(true)
  esPrincipal  Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  projects     projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([activo])
  @@index([esPrincipal])
}

model studio_setup_status {
  id                String                   @id @default(cuid())
  projectId         String                   @unique
  overallProgress   Int                      @default(0)
  isFullyConfigured Boolean                  @default(false)
  lastValidatedAt   DateTime                 @default(now())
  createdAt         DateTime                 @default(now())
  updatedAt         DateTime                 @updatedAt
  sections          setup_section_progress[]
  project           projects                 @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([isFullyConfigured])
  @@index([overallProgress])
}

model setup_section_progress {
  id                   String              @id @default(cuid())
  setupStatusId        String
  sectionId            String
  sectionName          String
  status               String
  completionPercentage Int                 @default(0)
  completedFields      Json
  missingFields        Json
  errors               Json?
  completedAt          DateTime?
  lastUpdatedAt        DateTime            @default(now())
  setupStatus          studio_setup_status @relation(fields: [setupStatusId], references: [id], onDelete: Cascade)

  @@unique([setupStatusId, sectionId])
  @@index([sectionId])
  @@index([status])
  @@index([completionPercentage])
}

model setup_section_config {
  id             String   @id @default(cuid())
  sectionId      String   @unique
  sectionName    String
  description    String
  requiredFields Json
  optionalFields Json
  dependencies   Json
  weight         Int      @default(10)
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([sectionId])
  @@index([isActive])
}

model setup_progress_log {
  id        String   @id @default(cuid())
  projectId String
  sectionId String?
  action    String
  oldStatus String?
  newStatus String?
  details   Json?
  source    String
  createdAt DateTime @default(now())

  @@index([projectId])
  @@index([sectionId])
  @@index([action])
  @@index([createdAt])
}

model project_reglas_agendamiento {
  id                 String   @id @default(cuid())
  projectId          String
  nombre             String
  descripcion        String?
  recurrencia        String
  capacidadOperativa Int      @default(1)
  status             String   @default("active")
  orden              Int      @default(0)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  projects           projects @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([status])
  @@index([orden])
}

model project_personal {
  id                   String                                 @id @default(cuid())
  projectId            String
  nombre               String
  email                String?
  telefono             String?
  tipo                 PersonalType
  categoriaId          String
  status               String                                 @default("activo")
  platformUserId       String?
  honorarios_fijos     Float?
  honorarios_variables Float?
  createdAt            DateTime                               @default(now())
  updatedAt            DateTime                               @updatedAt
  cuenta_clabe         String?
  telefono_emergencia  String?
  orden                Int?
  nominas              project_nominas[]
  categoria            project_categorias_personal            @relation(fields: [categoriaId], references: [id])
  platformUser         platform_user_profiles?                @relation(fields: [platformUserId], references: [id])
  project              projects                               @relation(fields: [projectId], references: [id], onDelete: Cascade)
  profile_assignments  project_personal_profile_assignments[]

  @@index([telefono_emergencia])
  @@index([cuenta_clabe])
  @@index([projectId])
  @@index([tipo])
  @@index([status])
  @@index([platformUserId])
}

model project_categorias_personal {
  id          String             @id @default(cuid())
  projectId   String
  nombre      String
  descripcion String?
  tipo        PersonalType
  color       String?
  icono       String?
  esDefault   Boolean            @default(false)
  orden       Int                @default(0)
  isActive    Boolean            @default(true)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  project     projects           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  personal    project_personal[]

  @@unique([projectId, nombre])
  @@index([projectId, tipo])
  @@index([projectId, isActive])
  @@index([esDefault])
  @@index([orden])
}

model project_personal_profiles {
  id                   String                                 @id @default(cuid())
  projectId            String
  nombre               String
  descripcion          String?
  orden                Int                                    @default(0)
  isActive             Boolean                                @default(true)
  createdAt            DateTime                               @default(now())
  updatedAt            DateTime                               @updatedAt
  personal_assignments project_personal_profile_assignments[]
  project              projects                               @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, nombre])
  @@index([projectId, isActive])
  @@index([orden])
}

model project_personal_profile_assignments {
  id         String                    @id @default(cuid())
  personalId String
  profileId  String
  createdAt  DateTime                  @default(now())
  personal   project_personal          @relation(fields: [personalId], references: [id], onDelete: Cascade)
  profile    project_personal_profiles @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@unique([personalId, profileId])
  @@index([personalId])
  @@index([profileId])
}

enum PlatformLeadBitacoraTipo {
  NOTA_PERSONALIZADA
  CAMBIO_ETAPA
  ASIGNACION_AGENTE
  DESASIGNACION_AGENTE
  CREACION_LEAD
  ACTUALIZACION_DATOS
  LLAMADA_REALIZADA
  EMAIL_ENVIADO
  REUNION_AGENDADA
  CONTRATO_FIRMADO
  SUSCRIPCION_ACTIVA
  CANCELACION
  DESCUENTO_APLICADO
  CODIGO_DESCUENTO_GENERADO
}

enum UnidadMedida {
  BOOLEAN
  CANTIDAD
  HORAS
  USUARIOS
  CATALOGOS
  GB
  PROYECTOS
  COTIZACIONES
  LANDING_PAGES
}

enum UserRole {
  SUPER_ADMIN
  AGENTE
  SUSCRIPTOR
  PERSONAL_SUSCRIPTOR
  CLIENTE_SUSCRIPTOR
}

enum SubscriptionStatus {
  TRIAL
  ACTIVE
  CANCELLED
  PAUSED
  EXPIRED
}

enum LeadStatus {
  NUEVO
  CONTACTADO
  INTERESADO
  COTIZACION
  NEGOCIACION
  CONVERTIDO
  PERDIDO
}

enum PersonnelType {
  EMPLEADO
  PROVEEDOR
}

enum PersonalType {
  OPERATIVO
  ADMINISTRATIVO
  PROVEEDOR
}
