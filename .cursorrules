# ZENPro - Cursor Rules v2.0 (Modular Architecture)

## ğŸ¯ PROYECTO CORE

**Producto:** ZEN - Plataforma modular SaaS para estudios fotogrÃ¡ficos  
**Stack:** Next.js 15 + TypeScript 5 + React 19 + Prisma + Supabase + Tailwind 4  
**Arquitectura:** Multi-tenant con sistema de mÃ³dulos activables

## ğŸ§© ARQUITECTURA MODULAR

**MÃ³dulos Core MVP:**

- ZEN Manager (incluido en todos los planes)
- ZEN Magic (IA - planes Pro+)
- ZEN Marketing (CRM - planes Pro+)

**MÃ³dulos Add-ons (Fase 2+):**

- ZEN Payment (+$10 USD/mes)
- ZEN Conversations (+$15 USD/mes)
- ZEN Cloud (+$15 USD/mes)
- ZEN Invitation (+$12 USD/mes)

**GestiÃ³n de MÃ³dulos:**

```typescript
// Verificar si mÃ³dulo estÃ¡ activo para studio
const hasModule = await checkStudioModule(studioId, "payment");

// Activar mÃ³dulo para studio
await activateStudioModule(studioId, "payment", configData);
```

## ğŸ—ï¸ ESTRUCTURA DE DIRECTORIOS

```
src/
â”œâ”€â”€ app/(authenticated)/
â”‚   â”œâ”€â”€ admin/              # Super Admin
â”‚   â”œâ”€â”€ agente/             # Agentes CRM
â”‚   â””â”€â”€ studio/[slug]/      # Suscriptores
â”‚       â”œâ”€â”€ manager/        # ZEN Manager
â”‚       â”œâ”€â”€ magic/          # ZEN Magic
â”‚       â”œâ”€â”€ marketing/      # ZEN Marketing
â”‚       â”œâ”€â”€ payment/        # ZEN Payment (add-on)
â”‚       â””â”€â”€ configuracion/  # ConfiguraciÃ³n cross-mÃ³dulo
â”œâ”€â”€ components/ui/
â”‚   â”œâ”€â”€ zen/               # ZEN Design System (USAR PRIMERO)
â”‚   â””â”€â”€ shadcn/            # Base components (fallback)
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ actions/           # Server Actions por mÃ³dulo
â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”œâ”€â”€ agente/
â”‚   â”‚   â”œâ”€â”€ studio/
â”‚   â”‚   â””â”€â”€ shared/
â”‚   â””â”€â”€ modules/           # LÃ³gica de gestiÃ³n de mÃ³dulos
â””â”€â”€ types/                 # TypeScript types
```

## ğŸ¨ DISEÃ‘O ZEN (PRIORIDAD #1)

**Tema Base:** Dark mode zinc (zinc-950/900/800)  
**Variaciones por Rol:**

- Admin: Emerald accent
- Agente: Blue accent
- Studio: Purple accent

**Componentes Disponibles:**

- Base: ZenButton, ZenInput, ZenCard, ZenBadge, ZenTextarea
- Layout: ZenSidebar, ZenNavbar (prÃ³ximos)
- Forms: ZenFormSection, ZenSelect (prÃ³ximo)

**Imports OBLIGATORIOS:**

```typescript
// âœ… SIEMPRE PRIMERO - ZEN Design System
import { ZenButton, ZenInput, ZenCard } from "@/components/ui/zen";

// âœ… Solo si NO existe en ZEN
import { Dialog } from "@/components/ui/shadcn/dialog";

// âŒ PROHIBIDO - Rutas directas
import { ZenButton } from "@/components/ui/zen/base/ZenButton";
```

## ğŸ”§ CÃ“DIGO

**TypeScript:**

- Strict mode SIEMPRE enabled
- NO usar `any` (usar `unknown` si es necesario)
- Tipar TODAS las props y retornos
- Preferir `interface` sobre `type` para objetos

**React:**

- Componentes funcionales SIEMPRE
- `"use client"` solo cuando necesario (eventos, hooks)
- `useCallback` para funciones en deps
- `useMemo` para cÃ¡lculos costosos
- Server Components por defecto

**Next.js:**

- Server Actions para mutaciones
- API Routes SOLO para webhooks externos
- Dynamic routes con `[slug]` o `[id]`
- Metadata API para SEO

## ğŸ—„ï¸ BASE DE DATOS

**Naming Convention (CRÃTICO):**

- Tablas: `snake_case` plural (ej: `studio_modules`)
- Columnas: `snake_case` (ej: `is_active`, `created_at`)
- Relaciones: `{tabla_singular}_id` (ej: `studio_id`)
- Idioma: InglÃ©s tÃ©cnico, espaÃ±ol para enums de negocio

**Prisma Best Practices:**

```prisma
// âœ… CORRECTO
model studio_modules {
  id         String   @id @default(cuid())
  studio_id  String
  module_id  String
  is_active  Boolean  @default(false)
  created_at DateTime @default(now())

  studio projects @relation(fields: [studio_id], references: [id])

  @@unique([studio_id, module_id])
  @@index([studio_id, is_active])
}

// âŒ INCORRECTO
model StudioModules {  // PascalCase
  studioId String     // camelCase
  ModuleId String     // Mixto
}
```

**Supabase:**

- Auth con `@supabase/ssr`
- RLS habilitado SIEMPRE
- Client/Server separation estricta

## ğŸ“ CONVENCIONES

**Naming:**

- Archivos: `kebab-case.tsx`
- Componentes: `PascalCase`
- Variables: `camelCase`
- Constantes: `UPPER_SNAKE_CASE`
- Server Actions: `verbSustantivo` (ej: `crearLead`, `activarModulo`)

**Imports (Orden estricto):**

```typescript
// 1. React/Next
import React from "react";
import { NextResponse } from "next/server";

// 2. Third-party
import { PrismaClient } from "@prisma/client";

// 3. ZEN Design System (SIEMPRE PRIMERO)
import { ZenButton, ZenInput } from "@/components/ui/zen";

// 4. Shadcn (solo fallback)
import { Dialog } from "@/components/ui/shadcn/dialog";

// 5. Local (types â†’ utils â†’ components)
import type { Lead } from "@/types/lead";
import { formatDate } from "@/lib/utils";
import { LeadForm } from "./components/LeadForm";
```

## ğŸš¨ PROHIBIDO (HARD RULES)

- âŒ Usar `any` en TypeScript (usar `unknown` + type guards)
- âŒ Mutar props directamente
- âŒ `useEffect` sin deps array correctas
- âŒ Hardcodear strings repetidos (usar constantes)
- âŒ Prisma queries en Client Components
- âŒ Modificar archivos `.env*` (usar `.env.local`)
- âŒ Usar Shadcn/ui si existe componente ZEN
- âŒ Mezclar espaÃ±ol e inglÃ©s en nombres tÃ©cnicos
- âŒ Queries sin Ã­ndices en columnas filtradas

## âœ… SIEMPRE HACER

- âœ… Usar ZEN Design System como primera opciÃ³n
- âœ… Tipado fuerte TypeScript (interfaces explÃ­citas)
- âœ… Error handling con try/catch + logs
- âœ… Loading states en TODAS las acciones async
- âœ… ValidaciÃ³n con Zod en Server Actions
- âœ… Comentarios JSDoc para funciones pÃºblicas
- âœ… Verificar permisos de mÃ³dulo antes de renderizar
- âœ… Ãndices en columnas usadas en WHERE/JOIN

## ğŸ¯ PATRONES POR MÃ“DULO

**Server Actions Pattern:**

```typescript
// src/lib/actions/studio/manager/leads.actions.ts
"use server";

import { prisma } from "@/lib/prisma";
import { checkStudioModule } from "@/lib/modules";
import { LeadCreateSchema } from "./leads.schemas";

export async function crearLead(studioSlug: string, data: unknown) {
  // 1. Verificar mÃ³dulo activo
  const hasModule = await checkStudioModule(studioSlug, "manager");
  if (!hasModule) {
    throw new Error("MÃ³dulo ZEN Manager no activo");
  }

  // 2. Validar datos
  const validatedData = LeadCreateSchema.parse(data);

  // 3. LÃ³gica de negocio
  const lead = await prisma.platform_leads.create({
    data: { ...validatedData },
  });

  // 4. Revalidar cache
  revalidatePath(`/studio/${studioSlug}/manager/kanban`);

  return lead;
}
```

**Formularios ZEN:**

```typescript
<form onSubmit={handleSubmit} className="space-y-6">
  <ZenInput
    label="Nombre del Lead"
    name="nombre"
    required
    error={errors.nombre}
    hint="Nombre completo del prospecto"
  />

  <ZenButton
    type="submit"
    variant="primary"
    loading={isSubmitting}
    loadingText="Guardando..."
  >
    Guardar Lead
  </ZenButton>
</form>
```

## ğŸ”’ SEGURIDAD

- Supabase Auth + JWT
- Middleware para rutas protegidas
- RLS en TODAS las tablas
- ValidaciÃ³n cliente + servidor (doble capa)
- Rate limiting en API Routes crÃ­ticas
- SanitizaciÃ³n de inputs del usuario

## ğŸ“¦ DEPENDENCIAS CLAVE

```json
{
  "next": "15.5.2",
  "react": "19.1.0",
  "typescript": "5",
  "@prisma/client": "6.15.0",
  "@supabase/supabase-js": "2.57.4",
  "tailwindcss": "4",
  "lucide-react": "latest",
  "sonner": "latest"
}
```

## ğŸ¤– USO DE CURSOR AI

**Sonnet 4.5 (Composer/Agent):**

- Arquitectura de mÃ³dulos
- Function Calling IA
- Refactoring complejo
- Code review crÃ­tico

**Sonnet 3.5 (Chat):**

- CRUD operations
- Componentes UI
- DocumentaciÃ³n
- Queries simples

**Claude Code (Terminal):**

- Migraciones DB
- Scripts automatizaciÃ³n
- AnÃ¡lisis estÃ¡tico

---

**MantÃ©n cÃ³digo limpio, modular y siguiendo ZEN Design System.**  
**Prioriza experiencia del usuario (fotÃ³grafo no-tÃ©cnico, mobile-first).**
